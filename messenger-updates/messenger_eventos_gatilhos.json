[{"id":"1","nomeamigavel":"PET - Serviço liberado","nomeinstrucao":"TR_Messenger_PetShop_Liberado","nometabela":"Agenda","tipoinstrucao":"TRIGGER","gatilhosqlcreate":"CREATE TRIGGER [dbo].[TR_Messenger_PetShop_Liberado]ON [dbo].[Agenda]AFTER UPDATEASBEGIN      DECLARE @Desativado BIT   DECLARE @NOMETABELA VARCHAR(50)   DECLARE @INSTRUCAO INT   DECLARE @PetShop_AcompLiberadoNovo BIT   SELECT @Desativado = Desativado, @NOMETABELA=NomeTabela, @INSTRUCAO=ID   FROM messenger_eventos_gatilhos Where ID={idRegistro}    SELECT @PetShop_AcompLiberadoNovo = PetShop_AcompLiberado FROM [inserted]      if @Desativado = 0   BEGIN      IF @PetShop_AcompLiberadoNovo <> 0      BEGIN         -- Inserir o ID (Seq) da Agenda na tabela messenger_eventos         INSERT INTO messenger_eventos (NomeTabela, Registro, DataHoraEvento, IDEvento, DataHoraDisparo)         SELECT            @NOMETABELA, i.Seq, GETDATE(), @INSTRUCAO, GETDATE()         FROM            inserted i            INNER JOIN deleted d ON i.Seq = d.Seq         Where             i.PetShop_AcompLiberado<>0      END;   END;END;","desativado":false,"moduloapp":"PETSHOP","idtipo":"2","idinstrucao":"1"},{"id":"2","nomeamigavel":"PET - Taxi","nomeinstrucao":"TR_Messenger_PetShop_TaxiPet","nometabela":"Agenda","tipoinstrucao":"TRIGGER","gatilhosqlcreate":"CREATE TRIGGER [dbo].[TR_Messenger_PetShop_TaxiPet]ON [dbo].[Agenda]AFTER UPDATEASBEGIN      DECLARE @Desativado BIT   DECLARE @NOMETABELA VARCHAR(50)   DECLARE @INSTRUCAO INT   DECLARE @Comentario Varchar(50)   SELECT @Desativado = Desativado, @NOMETABELA=NomeTabela, @INSTRUCAO=ID   FROM messenger_eventos_gatilhos Where ID={idRegistro}    SELECT @Comentario = Comentário FROM [inserted]      if @Desativado = 0   BEGIN      IF @Comentario = 'TAXI PET'      BEGIN         -- Inserir o ID (Seq) da Agenda na tabela messenger_eventos         INSERT INTO messenger_eventos (NomeTabela, Registro, DataHoraEvento, IDEvento, DataHoraDisparo)         SELECT            @NOMETABELA, i.Seq, GETDATE(), @INSTRUCAO, i.Retorno +' '+ i.RetornoHora         FROM            inserted i         WHERE             i.TaxiDog_Agendado<>0 And TaxiDog_Coletado=0 And TaxiDog_Entregue=0 And DATEADD(DAY,0, i.Retorno) +' '+ CONVERT(varchar(8), i.RetornoHora, 108) <= GETDATE()      END;   END;END;","desativado":false,"moduloapp":"PETSHOP","idtipo":"3","idinstrucao":"1"},{"id":"3","nomeamigavel":"PET - Vacinas alerta 1 dia antes","nomeinstrucao":"TR_Messenger_PetShop_Vacinas","nometabela":"PetShop_Vacinas","tipoinstrucao":"TRIGGER","gatilhosqlcreate":"CREATE TRIGGER [dbo].[TR_Messenger_PetShop_Vacinas]ON [dbo].[PetShop_Vacinas]AFTER INSERTASBEGIN      DECLARE @Desativado BIT   DECLARE @NOMETABELA VARCHAR(50)   DECLARE @INSTRUCAO INT   DECLARE @Comentario Varchar(50)   SELECT @Desativado = Desativado, @NOMETABELA=NomeTabela, @INSTRUCAO=ID   FROM messenger_eventos_gatilhos Where ID={idRegistro}      if @Desativado = 0   BEGIN         -- Inserir o ID (Seq) da Agenda na tabela messenger_eventos         INSERT INTO messenger_eventos (NomeTabela, Registro, DataHoraEvento, IDEvento, DataHoraDisparo)         SELECT            @NOMETABELA, i.ID, GETDATE(), @INSTRUCAO, DATEADD(DAY,-1, i.DataVacinacao)+' 08:00:00'          FROM            inserted i      END;END;","desativado":false,"moduloapp":"PETSHOP","idtipo":"4","idinstrucao":"2"},{"id":"4","nomeamigavel":"Aniversário dos Clientes","nomeinstrucao":"Aniversariantes","nometabela":"","tipoinstrucao":"LISTA","gatilhosqlcreate":"","desativado":false,"moduloapp":"TODOS","idtipo":"6","idinstrucao":"3"},{"id":"5","nomeamigavel":"Aniversário dos PET's","nomeinstrucao":"Aniversariantes_Pet","nometabela":"","tipoinstrucao":"LISTA","gatilhosqlcreate":"","desativado":false,"moduloapp":"PETSHOP","idtipo":"7","idinstrucao":"4"},{"id":"6","nomeamigavel":"Agendamento 1 dia antes","nomeinstrucao":"TR_Messenger_AlertaAgendamento","nometabela":"Agenda","tipoinstrucao":"TRIGGER","gatilhosqlcreate":"CREATE TRIGGER [dbo].[TR_Messenger_AlertaAgendamento]ON [dbo].[Agenda]AFTER UPDATEASBEGIN      DECLARE @Desativado BIT   DECLARE @NOMETABELA VARCHAR(50)   DECLARE @INSTRUCAO INT   DECLARE @Comentario Varchar(50)   SELECT @Desativado = Desativado, @NOMETABELA=NomeTabela, @INSTRUCAO=ID   FROM messenger_eventos_gatilhos Where ID={idRegistro}    SELECT @Comentario = Comentário FROM [inserted]      if @Desativado = 0   BEGIN         -- Inserir o ID (Seq) da Agenda na tabela messenger_eventos         INSERT INTO messenger_eventos (NomeTabela, Registro, DataHoraEvento, IDEvento, DataHoraDisparo)         SELECT            @NOMETABELA, i.Seq, GETDATE(), @INSTRUCAO, DATEADD(DAY,-1, i.Retorno) +' '+ CONVERT(varchar(8), i.RetornoHora, 108)         FROM            inserted i         WHERE             i.RetornoHora IS NOT NULL             AND DATEADD(DAY,-1, i.Retorno)<=GETDATE()            AND i.Retorno > GETDATE()            AND i.PetShop_AcompLiberado=0            AND i.TaxiDog_Agendado=0   END;END;","desativado":false,"moduloapp":"TODOS","idtipo":"5","idinstrucao":"1"}]
