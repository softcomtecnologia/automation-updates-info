[{"id":"1","nomeinstrucao":"Messenger_Eventos_Petshop_Agenda_Add","instrucaosql":"INSERT INTO messenger_envio (id_notificacao_tipo, data_hora_geracao, data_hora_envio, origem_id_pessoa, destino_fone, origem_id_registro, status, mensagem_descricao, mensagem_anexo, contato_nome, contato_setor)SELECT    mt.id AS id_notificacao_tipo,    GETDATE() AS data_hora_geracao,    GETDATE() AS data_hora_envio,    1 AS origem_id_pessoa,    cf.DDD + cf.Fone AS destino_fone,    c.[Código do Cliente] AS origem_id_registro,    'Não Enviada' AS status,   REPLACE(REPLACE(REPLACE(REPLACE(mt.mensagem_descricao, '{NomeContato}', cf.NomeContato), '{NomePet}', p.Nome_Pet),'{DataHoraAgendamento}', CONVERT(varchar(10),a.Retorno, 103)+' '+ CONVERT(varchar(8),a.RetornoHora, 108)),'{NomeEmpresa}', (SELECT Fantasia FROM Integrar_Lojas WHERE Loja = a.LojaOrigem)) AS mensagem_descricao,   mt.tipo_anexo_caminho AS mensagem_anexo,    cf.NomeContato AS contato_nome,    cf.Setor AS contato_setorFROM messenger_eventos meINNER JOIN messenger_eventos_gatilhos meg ON me.IDEvento = meg.IDINNER JOIN Agenda a ON me.Registro = a.SeqINNER JOIN messenger_tipo mt ON meg.IDTipo = mt.idINNER JOIN [Cadastro de Clientes] c ON a.[Código do Cliente] = c.[Código do Cliente]INNER JOIN [cadastro de Clientes_Fones] cf ON c.[Código do Cliente] = cf.CodigoDoClienteINNER JOIN PetShop_CadastroPET p ON a.ID_Pet = p.ID_PetWHERE    me.ID = @ID    AND cf.ReceberNotificacoes = 1    AND cf.WhatsApp = 1    AND (me.DataHoraDisparo <= GETDATE())    AND me.Enviado = 0;"},{"id":"2","nomeinstrucao":"Messenger_Eventos_Petshop_Vacinas_Add","instrucaosql":"INSERT INTO messenger_envio (id_notificacao_tipo, data_hora_geracao, data_hora_envio, origem_id_pessoa, destino_fone, origem_id_registro, status, mensagem_descricao, mensagem_anexo, contato_nome, contato_setor)SELECT        mt.id AS id_notificacao_tipo, GETDATE() AS data_hora_geracao, GETDATE() AS data_hora_envio, 1 AS origem_id_pessoa, cf.DDD + cf.Fone AS Expr2, cc.[Código do Cliente], 'Não Enviada' AS Expr6,                          REPLACE(REPLACE(REPLACE(REPLACE(mt.mensagem_descricao, '{NomeContato}', cf.NomeContato), '{NomePet}', pc.Nome_Pet),'{NomeEmpresa}', (Select Fantasia From Integrar_Lojas Where Loja = pv.LojaOrigem)),'{DataHoraAgendamento}', Convert(varChar(10), pv.DataVacinacao,103)) AS mensagem_descricao, mt.tipo_anexo_caminho, cf.NomeContato, cf.SetorFROM            dbo.messenger_eventos AS me INNER JOIN                         dbo.messenger_eventos_gatilhos AS meg ON me.IDEvento = meg.ID INNER JOIN                         dbo.messenger_tipo AS mt ON meg.IDTipo = mt.id INNER JOIN                         dbo.PetShop_Vacinas AS pv ON me.Registro = pv.ID INNER JOIN                         dbo.[Cadastro de Clientes] AS cc ON pv.ID_Cliente = cc.[Código do Cliente] INNER JOIN                         dbo.[cadastro de Clientes_Fones] AS cf ON cc.[Código do Cliente] = cf.CodigoDoCliente INNER JOIN                         dbo.PetShop_CadastroPET AS pc ON pv.ID_PET = pc.ID_PetWHERE        (me.ID = @ID) AND (cf.ReceberNotificacoes = 1) AND (cf.WhatsApp = 1) AND (me.DataHoraDisparo IS NULL OR                         me.DataHoraDisparo <= GETDATE()) AND (me.Enviado = 0)"},{"id":"3","nomeinstrucao":"Messenger_Eventos_Aniversariantes_Add","instrucaosql":"INSERT INTO messenger_envio (id_notificacao_tipo, data_hora_geracao, data_hora_envio, origem_id_pessoa, destino_fone, origem_id_registro, status, mensagem_descricao, mensagem_anexo, contato_nome, contato_setor)SELECT    mt.id AS id_notificacao_tipo,    GETDATE() AS data_hora_geracao,    GETDATE() AS data_hora_envio,    1 AS origem_id_pessoa,    cf.DDD + cf.Fone AS Expr2,    cc.[Código do Cliente],    'Não Enviada' AS Expr6,    REPLACE(REPLACE(mt.mensagem_descricao, '{NomeContato}', cf.NomeContato),'{NomeEmpresa}',  (Select Fantasia From Integrar_Lojas Where Loja = mt.loja_origem)) AS mensagem_descricao,    mt.tipo_anexo_caminho,    cf.NomeContato,    cf.SetorFROM [Cadastro de Clientes] ccINNER JOIN [cadastro de Clientes_Fones] cf ON cc.[Código do Cliente] = cf.CodigoDoCliente, messenger_eventos meINNER JOIN (messenger_eventos_gatilhos mg INNER JOIN messenger_tipo mt ON mg.IDTipo = mt.id) ON me.IDEvento = mg.IDWHERE    me.ID = @ID    AND cf.WhatsApp = 1    AND (me.DataHoraDisparo IS NULL OR me.DataHoraDisparo <= GETDATE())    AND (FORMAT(cf.DataNascimento, 'dd/MM') = FORMAT(me.DataHoraDisparo, 'dd/MM'))    AND me.Enviado = 0;"},{"id":"4","nomeinstrucao":"Messenger_Eventos_Petshop_PetAniversario_Add","instrucaosql":"INSERT INTO messenger_envio (id_notificacao_tipo, data_hora_geracao, data_hora_envio, origem_id_pessoa, destino_fone, origem_id_registro, status, mensagem_descricao, mensagem_anexo, contato_nome, contato_setor)SELECT    mt.id AS id_notificacao_tipo,    GETDATE() AS data_hora_geracao,    GETDATE() AS data_hora_envio,    1 AS origem_id_pessoa,    cf.DDD + cf.Fone AS FoneFull,    cc.[Código do Cliente],    'Não Enviada' AS StatusMesssage,    REPLACE(REPLACE(REPLACE(mt.mensagem_descricao, '{NomeContato}', cf.NomeContato), '{NomePet}', cp.Nome_Pet),'{NomeEmpresa}', (Select Fantasia From Integrar_Lojas Where Loja = mt.loja_origem)) AS mensagem_descricao,    mt.tipo_anexo_caminho,    cf.NomeContato,    cf.SetorFROM messenger_eventos meINNER JOIN (messenger_eventos_gatilhos megINNER JOIN messenger_tipo mt ON meg.IDTipo = mt.id) ON me.IDEvento = meg.ID,([Cadastro de Clientes] cc INNER JOIN [cadastro de Clientes_Fones] cf On cc.[Código do Cliente] = cf.CodigoDoCliente)INNER JOIN PetShop_CadastroPET cp on cc.[Código do Cliente] = cp.ClienteIDWHERE    me.ID = @ID    AND cf.ReceberNotificacoes = 1    AND cf.WhatsApp = 1    AND (me.DataHoraDisparo IS NULL OR me.DataHoraDisparo <= GETDATE())    AND (FORMAT(cp.DataNascimento_Pet, 'dd/MM') = FORMAT(me.DataHoraDisparo, 'dd/MM'))    AND me.Enviado = 0;"}]
